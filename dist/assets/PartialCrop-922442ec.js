import{j as t}from"./index-f46094da.js";import{r as l}from"./vendor-2f5676f8.js";function ee(){const[m,A]=l.useState(null),[i,k]=l.useState([]),[D,y]=l.useState(!1),[_,I]=l.useState(!1),[S,W]=l.useState(!1),[E,Y]=l.useState(0),[H,U]=l.useState(0),[M,L]=l.useState(null),o=l.useRef(null),s=l.useRef(null),T=l.useRef(null),j=l.useRef(),z=e=>{var r;const n=(r=e.target.files)==null?void 0:r[0];n&&$(n)},$=e=>{if(!e.type.startsWith("image/")){alert("Please select an image file!");return}typeof window<"u"&&window.gtag&&window.gtag("event","file_upload",{event_category:"walnut_cropper",event_label:"image_upload",value:1});const n=new FileReader;n.onload=r=>{var c;const a=(c=r.target)==null?void 0:c.result;A(a),k([]),y(!1)},n.readAsDataURL(e)},F=e=>{e.preventDefault()},P=e=>{e.preventDefault();const n=e.dataTransfer.files;n.length>0&&$(n[0])},C=l.useCallback(()=>{s.current&&(s.current.style.transform="translate(50px, 50px)",s.current.style.width="150px",s.current.style.height="150px",s.current.style.display="block")},[]),X=e=>{if(!e.target.classList.contains("crop-handle")){if(I(!0),s.current){const n=s.current.getBoundingClientRect();Y(e.clientX-n.left),U(e.clientY-n.top)}e.preventDefault()}},g=e=>{W(!0);const n=e.target.classList[1];L(n),e.preventDefault(),e.stopPropagation()},b=l.useCallback(e=>{!s.current||!o.current||(j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{requestAnimationFrame(()=>{if(_){const n=o.current.getBoundingClientRect();let r=e.clientX-n.left-E,a=e.clientY-n.top-H;r=Math.max(0,Math.min(r,o.current.offsetWidth-s.current.offsetWidth)),a=Math.max(0,Math.min(a,o.current.offsetHeight-s.current.offsetHeight)),s.current.style.transform=`translate(${r}px, ${a}px)`}else if(S){const n=o.current.getBoundingClientRect(),r=e.clientX-n.left,a=e.clientY-n.top;B(r,a)}})},16))},[_,S,E,H,M]),B=(e,n)=>{if(!s.current||!o.current)return;const a=s.current.style.transform.match(/translate\((\d+)px,\s*(\d+)px\)/),c=a?parseInt(a[1]):50,d=a?parseInt(a[2]):50,R=parseInt(s.current.style.width),u=parseInt(s.current.style.height);switch(M){case"se":s.current.style.width=Math.min(e-c,o.current.offsetWidth-c)+"px",s.current.style.height=Math.min(n-d,o.current.offsetHeight-d)+"px";break;case"nw":const w=c+R-e,x=d+u-n;e>=0&&n>=0&&w>20&&x>20&&(s.current.style.transform=`translate(${e}px, ${n}px)`,s.current.style.width=w+"px",s.current.style.height=x+"px");break;case"ne":const p=e-c,h=d+u-n;n>=0&&p>20&&h>20&&(s.current.style.transform=`translate(${c}px, ${n}px)`,s.current.style.width=Math.min(p,o.current.offsetWidth-c)+"px",s.current.style.height=h+"px");break;case"sw":const f=c+R-e,v=n-d;e>=0&&f>20&&v>20&&(s.current.style.transform=`translate(${e}px, ${d}px)`,s.current.style.width=f+"px",s.current.style.height=Math.min(v,o.current.offsetHeight-d)+"px");break}},N=l.useCallback(()=>{I(!1),W(!1),L(null)},[]),G=()=>{if(!s.current||!o.current)return;const e=parseInt(s.current.style.width),n=parseInt(s.current.style.height);if(e<20||n<20){alert("Crop area too small, please adjust the selection box!");return}const r=document.createElement("canvas"),a=r.getContext("2d");if(!a)return;const c=o.current.naturalWidth/o.current.offsetWidth,d=o.current.naturalHeight/o.current.offsetHeight,u=s.current.style.transform.match(/translate\((\d+)px,\s*(\d+)px\)/),w=(u?parseInt(u[1]):50)*c,x=(u?parseInt(u[2]):50)*d,p=e*c,h=n*d;if(r.width=p,r.height=h,o.current.complete&&o.current.naturalHeight!==0){a.drawImage(o.current,w,x,p,h,0,0,p,h);const f=r.toDataURL("image/png",1);if(f&&f.length>100){const v={dataUrl:f,name:`Walnut_${i.length+1}.png`};k([...i,v]),typeof window<"u"&&window.gtag&&window.gtag("event","crop_added",{event_category:"walnut_cropper",event_label:"crop_added",value:i.length+1}),alert(`Added ${i.length+1} crop area!
Tip: You can continue selecting other walnut areas`)}else alert("Crop failed, please try again!")}else alert("Image not fully loaded, please wait a moment!")},O=()=>{s.current&&(s.current.style.transform="translate(50px, 50px)",s.current.style.width="150px",s.current.style.height="150px")},q=()=>{if(i.length===0){alert("Please add some crop areas first!");return}y(!0)},J=e=>{const n=i[e];typeof window<"u"&&window.gtag&&window.gtag("event","single_download",{event_category:"walnut_cropper",event_label:"single_download",value:1});const r=document.createElement("a");r.download=n.name,r.href=n.dataUrl,r.style.display="none",document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r)},100)},V=()=>{if(i.length===0){alert("No images to download!");return}typeof window<"u"&&window.gtag&&window.gtag("event","batch_download",{event_category:"walnut_cropper",event_label:"batch_download",value:i.length});let e=0;const n=()=>{if(e>=i.length){alert(`Successfully downloaded ${i.length} images!`);return}const r=i[e],a=document.createElement("a");a.download=r.name,a.href=r.dataUrl,a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),e++,n()},500)};n()},K=()=>{y(!1)};return l.useEffect(()=>{m&&setTimeout(C,100)},[m,C]),l.useEffect(()=>(document.addEventListener("mousemove",b),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",N)}),[b,N]),l.useEffect(()=>{typeof window<"u"&&window.gtag&&window.gtag("config","G-N7DB775N0W",{page_title:"Walnut Image Cropper",page_location:window.location.href}),typeof window<"u"&&window.clarity&&window.clarity("set","page_title","Walnut Image Cropper")},[]),t.jsx("div",{className:"walnut-cropper",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"header",children:[t.jsx("h1",{children:"ü•ú Walnut Image Cropper"}),t.jsx("p",{children:"Easily crop multiple walnut images into individual files"})]}),t.jsxs("div",{className:"instructions",children:[t.jsx("h4",{children:"üìñ Instructions:"}),t.jsxs("ul",{children:[t.jsx("li",{children:"Click the upload area to select your walnut image"}),t.jsx("li",{children:"Drag on the image to select the area to crop"}),t.jsx("li",{children:"You can adjust the selection box size and position"}),t.jsx("li",{children:'Click "Add Crop" to save the current selection'}),t.jsx("li",{children:"Repeat the operation to crop multiple walnuts"}),t.jsx("li",{children:"Finally download all crop results in batch"})]})]}),!m&&t.jsxs("div",{className:"upload-section",children:[t.jsxs("div",{className:"upload-area",onClick:()=>{var e;return(e=T.current)==null?void 0:e.click()},onDragOver:F,onDrop:P,children:[t.jsx("div",{className:"upload-icon",children:"üì∏"}),t.jsx("div",{className:"upload-text",children:"Click to select image or drag here"}),t.jsx("div",{className:"upload-hint",children:"Supports JPG, PNG, GIF formats"})]}),t.jsx("input",{type:"file",ref:T,accept:"image/*",onChange:z,style:{display:"none"}})]}),m&&!D&&t.jsxs("div",{className:"crop-section",children:[t.jsxs("div",{className:"image-container",children:[t.jsx("img",{ref:o,src:m,alt:"Original",onLoad:C}),t.jsxs("div",{ref:s,className:"crop-overlay",onMouseDown:X,children:[t.jsx("div",{className:"crop-handle nw",onMouseDown:g}),t.jsx("div",{className:"crop-handle ne",onMouseDown:g}),t.jsx("div",{className:"crop-handle sw",onMouseDown:g}),t.jsx("div",{className:"crop-handle se",onMouseDown:g})]})]}),t.jsxs("div",{className:"controls",children:[t.jsx("button",{className:"btn",onClick:G,children:"‚ûï Add Crop"}),t.jsx("button",{className:"btn secondary",onClick:O,children:"üîÑ Reset Selection"}),t.jsx("button",{className:"btn secondary",onClick:q,children:"üìã View Results"})]})]}),D&&t.jsxs("div",{className:"results",children:[t.jsx("h3",{children:"üéâ Crop Results"}),t.jsx("div",{className:"cropped-images",children:i.map((e,n)=>t.jsxs("div",{className:"cropped-item",children:[t.jsx("img",{src:e.dataUrl,alt:e.name}),t.jsx("div",{children:e.name}),t.jsx("button",{className:"download-btn",onClick:()=>J(n),children:"üì• Download"})]},n))}),t.jsxs("div",{className:"controls",children:[t.jsx("button",{className:"btn",onClick:V,children:"üì• Download All"}),t.jsx("button",{className:"btn secondary",onClick:K,children:"‚Ü©Ô∏è Continue Editing"})]})]})]})})}export{ee as default};
